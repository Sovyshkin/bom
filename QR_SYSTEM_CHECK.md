## Проверка QR системы

### 1. Генерация QR кодов

Компонент `QRGenerator.vue` настроен для генерации QR кодов с использованием домена `http://localhost:8080`.

**Формат URL:** `http://localhost:8080/qr/{proektId}/{elementId}/{stageId}`

**Тестовые данные:**
- proektId: 1
- elementId: 25  
- stageId: 156

**Сгенерированный QR код будет содержать URL:** `http://localhost:8080/qr/1/25/156`

### 2. Обработка QR сканирования

Маршрут в `router.js`:
```javascript
{
  path: '/qr/:proektId/:elementId/:stageId',
  name: 'WorkerStageQR',
  component: WorkerStage,
  meta: { requiresAuth: true }
}
```

**Аутентификация:**
- Если пользователь не авторизован, его перенаправит на страницу входа
- После успешного входа, пользователя автоматически перенаправит обратно на QR страницу

### 3. Управление статусами

**Иерархия статусов:**
```
Проект (proekt)
├── status_work: "Не начат" | "В работе" | "Готов"
└── Элементы (element)
    ├── status_work: "Не начат" | "В работе" | "Готов"
    └── Этапы (etap)
        ├── status: "Не начат" | "В работе" | "Готов"
        └── status_work: "Не начат" | "В работе" | "Готов" (для совместимости)
```

**Логика каскадного обновления:**

1. **При изменении статуса этапа:**
   - Обновляется статус элемента на основе всех его этапов
   - Обновляется статус проекта на основе всех его элементов

2. **Правила определения статуса:**
   - "Готов" - если все дочерние элементы готовы
   - "В работе" - если есть хотя бы один элемент в работе или готовый
   - "Не начат" - если все элементы не начаты

### 4. API Endpoints

**Backend контроллер `etap.ts` содержит:**

1. `GET /api/etaps/element/:id/stages` - получить все этапы элемента
2. `GET /api/etaps/:id/stage` - получить конкретный этап
3. `PUT /api/etaps/:id/status` - обновить статус этапа

**Пример запроса обновления статуса:**
```javascript
PUT /api/etaps/156/status
{
  "status": "В работе",
  "userId": 1
}
```

### 5. Трекинг действий пользователя

**При начале работы (статус "В работе"):**
- `startedBy` - ID пользователя
- `startedAt` - время начала
- `who` - имя пользователя (для отображения)

**При завершении работы (статус "Готов"):**
- `finishedBy` - ID пользователя  
- `finishedAt` - время завершения

### 6. Проверка работы системы

**Для проверки QR генерации:**
1. Открыть `/qr-generator` в браузере
2. Нажать "Заполнить тестовыми данными"
3. Нажать "Сгенерировать QR-код"
4. Проверить, что URL содержит `http://localhost:8080/qr/1/25/156`

**Для проверки обновления статусов:**
1. Отсканировать QR код или перейти по ссылке
2. Авторизоваться, если нужно
3. Нажать "Приступить к работе"
4. Проверить в базе данных:
   - etap.status = "В работе"
   - element.status_work = "В работе" 
   - proekt.status_work = "В работе"

### 7. Возможные проблемы

1. **TypeScript ошибки в контроллере** - решены добавлением `as any` кастинга
2. **CORS ошибки при генерации QR** - используется внешний API сервис
3. **Несоответствие API endpoints** - исправлены пути в WorkerStage.vue

Все компоненты настроены и готовы к работе!